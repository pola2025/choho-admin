<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CORS 연결 최종 테스트 (변형)</title>
</head>
<body>
    <h1>CORS 연결 최종 테스트 (변형)</h1>
    <button id="postTestButton">1. POST 방식 테스트</button>
    <button id="getTestButton">2. GET 방식 (JSONP) 테스트</button>
    <div id="result" style="margin-top:20px; font-weight: bold;"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw9Fav0VorRG1ukk1StToVuBoHrPvVw_sqUGZacSuBimPbbI3f54O5in00Y6-Z91AEhtQ/exec';
        const resultDiv = document.getElementById('result');

        // 1. POST 방식 테스트 (기존 방식)
        document.getElementById('postTestButton').addEventListener('click', () => {
            resultDiv.textContent = 'POST 요청 보내는 중...';
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ test: 'ping' })
            })
            .then(res => res.json())
            .then(data => {
                resultDiv.textContent = `✅ POST 성공: ${data.message}`;
                alert('🎉 POST 성공!');
            })
            .catch(err => {
                resultDiv.textContent = `❌ POST 실패: ${err.message}`;
                console.error("POST Error:", err);
            });
        });

        // 2. GET 방식 (JSONP) 테스트
        document.getElementById('getTestButton').addEventListener('click', () => {
            resultDiv.textContent = 'GET(JSONP) 요청 보내는 중...';
            const callbackName = 'jsonpCallback_' + new Date().getTime();

            window[callbackName] = function(data) {
                resultDiv.textContent = `✅ GET(JSONP) 성공: ${data.message}`;
                alert('🎉 GET(JSONP) 성공!');
                delete window[callbackName];
                document.body.removeChild(script);
            };

            const script = document.createElement('script');
            script.src = `${SCRIPT_URL}?callback=${callbackName}`;
            script.onerror = () => {
                resultDiv.textContent = '❌ GET(JSONP) 실패: 스크립트 로드 에러';
                console.error("JSONP Error: Script loading failed.");
            };
            document.body.appendChild(script);
        });
    </script>
</body>
</html>
